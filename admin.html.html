<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GO TAXI SERVICES â€“ Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
h2{text-align:center;color:#1e88e5;margin-bottom:10px}
form{background:#fff;padding:15px;border-radius:8px;box-shadow:0 0 5px rgba(0,0,0,0.1)}
input, select, textarea{width:100%;padding:6px;margin:4px 0 10px 0;border:1px solid #ccc;border-radius:4px;font-size:14px}
button{padding:6px 10px;font-size:14px;border:none;border-radius:4px;cursor:pointer;margin:4px}
button.save{background:#1e88e5;color:#fff}
button.whatsapp{background:#25D366;color:#fff}
label{font-weight:bold;font-size:13px}
</style>
</head>
<body>

<h2>ðŸš– GO TAXI SERVICES â€“ Admin Panel</h2>

<form id="bookingForm">
<label>Trip Type</label>
<select id="tripType" required>
<option value="OW">ONE WAY</option>
<option value="RT">ROUND TRIP</option>
<option value="AT">AIRPORT TRANSFER</option>
<option value="MU">MULTI CITY</option>
</select>

<label>Trip ID</label>
<input type="text" id="tripId" placeholder="Auto generated" required>

<label>Booking Description</label>
<textarea id="bookingDescription" placeholder="Enter notes or special instructions"></textarea>

<label>Pickup Date</label>
<input type="date" id="pickupDate" required>

<label>Release Date</label>
<input type="date" id="releaseDate" required>

<label>No. of Days</label>
<input type="number" id="noOfDays" readonly>

<label>Time</label>
<input type="text" id="tripTime" placeholder="Enter time e.g. 12:00 PM" required>

<label>Cab Type</label>
<input type="text" id="cabType">

<label>Cab Details</label>
<input type="text" id="cabDetails">

<label>Customer Name</label>
<input type="text" id="customerName" required>

<label>Customer Phone</label>
<input type="text" id="customerPhone" placeholder="10 digit number" required>

<label>Driver Name</label>
<input type="text" id="driverName">

<label>Driver Phone</label>
<input type="text" id="driverPhone" placeholder="10 digit number">

<label>Pickup Location</label>
<input type="text" id="pickup">

<label>Going On</label>
<input type="text" id="goingOn">

<label>Drop Location</label>
<input type="text" id="drop">

<label>Total Amount</label>
<input type="number" id="totalAmount">

<label>Advance Paid</label>
<input type="number" id="advance">

<label>Balance</label>
<input type="number" id="balance" readonly>

<label>Driver Collection</label>
<input type="number" id="driverCollection">

<label>Extra Charges / Notes</label>
<input type="text" id="extraNote">

<button type="button" class="save" onclick="saveBooking()">Save Booking</button>
</form>

<br>
<button class="whatsapp" onclick="shareWhatsAppCustomer()">Share to Customer</button>
<button class="whatsapp" onclick="shareWhatsAppDriver()">Share to Driver</button>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbwM0voS_X939uEw6chWaD-md7_RHfgqtEx9REMAgNIqveWP0r9kp8nMnDi_05Z32Ed0/exec";


function generateTripID(){
  const type = document.getElementById("tripType").value;
  const randomNum = Math.floor(1000 + Math.random()*9000);
  return type + "-GTS-" + randomNum;
}

document.getElementById("tripType").addEventListener("change",()=>{
  document.getElementById("tripId").value = generateTripID();
});

// Auto calculate balance
function updateBalance(){
  const total = parseFloat(document.getElementById("totalAmount").value)||0;
  const adv = parseFloat(document.getElementById("advance").value)||0;
  document.getElementById("balance").value = total-adv;
}
document.getElementById("advance").addEventListener("input",updateBalance);
document.getElementById("totalAmount").addEventListener("input",updateBalance);

// Auto calculate No. of Days
function calculateDays(){
  const pickup = document.getElementById("pickupDate").value;
  const release = document.getElementById("releaseDate").value;
  if(pickup && release){
    const diff = new Date(release) - new Date(pickup);
    const days = Math.ceil(diff/(1000*60*60*24)) + 1;
    document.getElementById("noOfDays").value = days>0?days:1;
  }
}
document.getElementById("pickupDate").addEventListener("change",calculateDays);
document.getElementById("releaseDate").addEventListener("change",calculateDays);

function cleanNumber(n){
  if(!n) return "";
  n=n.replace(/\D/g,"");
  if(n.length===10) n="91"+n;
  return n;
}

function saveBooking(){
  const data = {
    "trip Id": document.getElementById("tripId").value,
    "tripType": document.getElementById("tripType").value,
    "tripDateTime": document.getElementById("pickupDate").value + " " + document.getElementById("tripTime").value,
    "releaseDate": document.getElementById("releaseDate").value,
    "noOfDays": document.getElementById("noOfDays").value,
    "cabType": document.getElementById("cabType").value,
    "cabDetails": document.getElementById("cabDetails").value,
    "bookingDescription": document.getElementById("bookingDescription").value,
    "customer Name": document.getElementById("customerName").value,
    "customerPhone": document.getElementById("customerPhone").value,
    "driverName": document.getElementById("driverName").value,
    "driverPhone": document.getElementById("driverPhone").value,
    "pickup": document.getElementById("pickup").value,
    "goingOn": document.getElementById("goingOn").value,
    "drop": document.getElementById("drop").value,
    "total Amount": document.getElementById("totalAmount").value,
    "advance": document.getElementById("advance").value,
    "balance": document.getElementById("balance").value,
    "driverCollection": document.getElementById("driverCollection").value,
    "extraNote": document.getElementById("extraNote").value,
    "createdAt": new Date().toISOString()
  };

  fetch(SHEET_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify(data)
  })
  .then(r=>{
    alert("Booking Saved Successfully! Thank You");
    document.getElementById("bookingForm").reset();
    document.getElementById("tripId").value = generateTripID();
  })
  .catch(err=>{
    alert("Error saving booking: "+err);
  });
}

function shareWhatsAppCustomer(){
  const name = document.getElementById("customerName").value;
  const phone = cleanNumber(document.getElementById("customerPhone").value);
  const tripId = document.getElementById("tripId").value;
  const pickup = document.getElementById("pickup").value;
  const goingOn = document.getElementById("goingOn").value;
  const drop = document.getElementById("drop").value;
  const cab = document.getElementById("cabType").value + " " + document.getElementById("cabDetails").value;
  const driver = document.getElementById("driverName").value + " ("+document.getElementById("driverPhone").value+")";
  const total = document.getElementById("totalAmount").value;
  const description = document.getElementById("bookingDescription").value;

  const msg = `GO TAXI SERVICES
Booking ID: ${tripId}
Cab: ${cab}
Driver: ${driver}
Pickup: ${pickup}
Going On: ${goingOn}
Drop: ${drop}
Fare: â‚¹${total}
${description? "Notes: "+description : ""}
Thank you for choosing GO TAXI SERVICES.
Website: https://gotaxiservices.com
Contact: 8434143546`;

  if(phone) window.open("https://api.whatsapp.com/send?phone="+phone+"&text="+encodeURIComponent(msg));
  else alert("Customer phone missing");
}

function shareWhatsAppDriver(){
  const phone = cleanNumber(document.getElementById("driverPhone").value);
  const tripId = document.getElementById("tripId").value;
  const customer = document.getElementById("customerName").value + " (" + document.getElementById("customerPhone").value + ")";
  const pickup = document.getElementById("pickup").value;
  const goingOn = document.getElementById("goingOn").value;
  const drop = document.getElementById("drop").value;
  const total = document.getElementById("totalAmount").value;
  const description = document.getElementById("bookingDescription").value;

  const msg = `GO TAXI SERVICES
Booking ID: ${tripId}
Customer: ${customer}
Pickup: ${pickup}
Going On: ${goingOn}
Drop: ${drop}
Amount: â‚¹${total}
${description? "Notes: "+description : ""}
Thank you for choosing GO TAXI SERVICES.
Website: https://gotaxiservices.com
Contact: 8434143546`;

  if(phone) window.open("https://api.whatsapp.com/send?phone="+phone+"&text="+encodeURIComponent(msg));
  else alert("Driver phone missing");
}
</script>

</body>
</html>
